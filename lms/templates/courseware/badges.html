<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>

<%block name="headextra">
  <%static:css group='course'/>
</%block>

<%block name="title"><title>${course.number} Badges</title></%block>

<%!
    from django.core.urlresolvers import reverse
%>

<%! from xmodule.util.date_utils import get_default_time_display %>


<style>
img.unlockable {
  filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale"); /* Firefox 10+, Firefox on Android */
  filter: grayscale( 100% );
  filter: gray;
  -webkit-filter: grayscale( 100% );
  -moz-filter: grayscale( 100% );
  -o-filter: grayscale( 100% );
  -ms-filter: grayscale( 100% );

  opacity: 0.4;
  -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=40)";
  filter: alpha(opacity=40);
  -moz-opacity:0.4;
  -khtml-opacity: 0.4;
}
input.mozilla_export {
  float: right;
  width: 75px;
  margin-left: 20px;
}
img.badge_image {
  float: left;
  width: 100px;
  margin-right: 20px;
  border-radius: 3px;
}
img.share_icon {
  float: right;
  width: 18px;
  padding: 3px;
}
.fakelink:hover {
  cursor: pointer;
}
</style>

<%block name="js_extra">
<script type="text/javascript" src="http://beta.openbadges.org/issuer.js"></script>
<script type="text/javascript">

$(document).ready(function() {

  var start_info_button = function() {
      $('.mozilla_info').hide();
  };
  start_info_button();

  $('.mozilla_export').click(function() {
    OpenBadges.issue(${badge_data['badge_urls']}, function(e,s) {});
  });

  var flip_info_button = function() {
    if (!$(this).parent().find('.mozilla_info').is(":visible")) {
      $('.mozilla_info').hide('blind', 100);
      $(this).parent().find('.mozilla_info').show('blind', 100).animate({queue: false});
    } else {
      $('.mozilla_info').hide('blind', 100);
    }
  };

  $('.toggle_mozilla').click(flip_info_button);
});

</script>
</%block>


<%include file="/courseware/course_navigation.html" args="active_page=''" />

<section class="container">
  <div class="profile-wrapper">

    <section class="course-info">
      <header>
        <h1>Badges for <i>${course.display_name}</i></h1>
      </header>

      %if len(badge_data['unlockable_badgeclasses']) != 0 or len(badge_data['earned_badges']) != 0:
      <ol class="chapters">
        %if len(badge_data['earned_badges']) != 0:
        <li>
          <h2>Earned</h2>
          <ol class="sections">
            %for i in range(len(badge_data['earned_badges'])):
              <%badge = badge_data['earned_badges'][i]%>
              <%badgeclass = badge.get('badge', {})%>
              <%num = badgeclass.get('number_awarded')%>
              <li>
                <img src="${badge.get('image')}" class="badge_image" />
                    <p>
                      <div class="fakelink toggle_mozilla" title="Export to Mozilla Backpack">
                        <img class="share_icon" src="/static/images/social/badges/open_badges.png" />
                      </div>
                      <a target="_blank" title="Share" href="https://plus.google.com/share?url=${badgeclass.get('criteria')}">
                        <img class="share_icon" src="/static/images/social/badges/social_googleplus.png" />
                      </a>
                      <a target="_blank" title="Tweet" href="https://twitter.com/intent/tweet?text=I earned the %22${badgeclass.get('name')}%22 badge in ${course.number} on %23edX!&url=${badgeclass.get('criteria')}&image=${badge.get('image')}">
                        <img class="share_icon" src="/static/images/social/badges/social_twitter.png" />
                      </a>
                      <a target="_blank" title="Share" href="https://www.facebook.com/dialog/feed?app_id=202824819884271&link=${badgeclass.get('criteria')}&picture=${badge.get('image')}&name=${badgeclass.get('name')}&description=${badgeclass.get('description')}&redirect_uri=http://localhost:8000/courses/${course.id}/badges">
                        <img class="share_icon" src="/static/images/social/badges/social_facebook.png" />
                      </a>
                    </p>
                    <div style="padding-left:120px">
                      <h3>${badgeclass.get('name')}</h3>
                      <p>
                        <b>${badgeclass.get('description')}</b><br />
                        awarded on <b>${badge.get('issuedOn')}</b> by
                        <a href="${badgeclass.get('issuer', {}).get('origin')}">
                          ${badgeclass.get('issuer', {}).get('name')}
                        </a><br />
                        <i>
                        %if num is not None:
                            ${num-1} other${' has' if num-1 is 1 else 's have'} this badge.
                        %endif
                        </i>
                      </p>
                      <div class="mozilla_info" style="display: none;">
                        <hr/>
                        <p>
                          <input type='button' class='mozilla_export' value='Export' />
                          Exporting these badges to <a href="http://beta.openbadges.org">Mozilla Backpack</a>? When signing in with Mozilla Persona, make sure to use your <b>${student.email}</b> email address.
                        </p>
                      </div>
                    </div>
              </li>
              %if i != len(badge_data['earned_badges']) - 1:
                <hr />
              %endif
            %endfor
          </ol>
        </li>
        %endif
        %if len(badge_data['unlockable_badgeclasses']) != 0:
        <li>
          <h2>Unlockable</h2>
          <ol class="sections">
            %for i in range(len(badge_data['unlockable_badgeclasses'])):
              <%badgeclass = badge_data['unlockable_badgeclasses'][i]%>
              <%num = badgeclass.get('number_awarded')%>
              <li>
                <table><tr>
                  <td><img src="${badgeclass.get('image')}" class="unlockable badge_image" /></td>
                  <td>
                    <p>
                    <b>${badgeclass.get('description')} </b><br />
                    <i>
                    %if num is not None:
                        ${num} other${' has' if num is 1 else 's have'} this badge.
                    %endif
                    </i>
                    </p>
                  </td>
                </tr></table>
              </li>
              %if i != len(badge_data['unlockable_badgeclasses']) - 1:
                <hr />
              %endif
            %endfor
          </ol>
        </li>
        %endif
      </ol>
      %else:
       <p>This course does not offer badges.</p>
      %endif

    </section>
  </div>
</section>
