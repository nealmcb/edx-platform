<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>

<%block name="headextra">
  <%static:css group='course'/>
</%block>

<%
    from django.core.urlresolvers import reverse
    from django.utils.translation import ugettext as _
    from xmodule.util.date_utils import get_default_time_display
%>


<%block name="title">
<% from django.utils.translation import ugettext as _ %>
<title>${_('{course_number} Badges').format(course_number=course.number)}</title>
</%block>

<style>
img.unlockable {
  filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale"); /* Firefox 10+, Firefox on Android */
  filter: grayscale( 100% );
  filter: gray;
  -webkit-filter: grayscale( 100% );
  -moz-filter: grayscale( 100% );
  -o-filter: grayscale( 100% );
  -ms-filter: grayscale( 100% );

  opacity: 0.5;
  -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";
  filter: alpha(opacity=50);
  -moz-opacity:0.5;
  -khtml-opacity: 0.5;
}
input.mozilla_export {
  float: right;
  width: auto;
  margin-left: 20px;
}
img.badge_image {
  float: left;
  width: 100px;
  margin-right: 20px;
  margin-bottom: 20px;
  border-radius: 3px;
}
img.share_icon {
  float: right;
  width: 20px;
  padding: 3px;
  border-radius: 5px;
}
.fakelink:hover {
  cursor: pointer;
}
</style>

<%block name="js_extra">
<script type="text/javascript" src="http://beta.openbadges.org/issuer.js"></script>
<script type="text/javascript">

$(document).ready(function() {

  var start_info_button = function() {
      $('.mozilla_info').hide();
  };
  start_info_button();

  $('.mozilla_export').click(function() {
    OpenBadges.issue(${badge_urls}, function(e,s) {});
  });

  var flip_info_button = function() {
    if (!$(this).parent().find('.mozilla_info').is(":visible")) {
      $('.mozilla_info').hide('blind', 100);
      $(this).parent().find('.mozilla_info').show('blind', 100).animate({queue: false});
    } else {
      $('.mozilla_info').hide('blind', 100);
    }
  };

  $('.toggle_mozilla').click(flip_info_button);
});

</script>
</%block>


<%include file="/courseware/course_navigation.html" args="active_page=''" />

<section class="container">
  <div class="profile-wrapper">

    <section class="course-info">
      <header>
        <h1>${_('Badges for {course_name}').format(course_name='<i>'+course.display_name+'</i>')}</h1>
      </header>

      %if len(badgeclasses) != 0 or len(badges) != 0:
      <ol class="chapters">
        %if len(badges) >= 0:
        <li>
          <h2>${_("Earned")}</h2>
          <ol class="sections">
            <%first = True%>

            %for badge in badges.values():
              <%badgeclass_url = badge.get('badge', {})%>
              <%badgeclass = badgeclasses.get(badgeclass_url, {})%>
              <%issuer = issuers.get(badgeclass.get('issuer'), {})%>
              <%num = badgeclass['edx_number_awarded']%>

              %if first:
                <%first = False%>
              %else:
                <hr style="clear:both;"/>
              %endif

              <li>
                <a href="${badgeclass.get('criteria')}">
                  <img src="${badge.get('image')}" class="badge_image" />
                </a>
                <p>
                  <div class="fakelink toggle_mozilla" title="${_("Export Badges to Mozilla Backpack")}">
                    <!--This image is a modified version of the images at http://openbadges.org/insignia/-->
                    <img class="share_icon" src="/static/images/badges/open_badges.png" />
                  </div>
                  <a target="_blank" title="${_("Share")}" href="https://plus.google.com/share?url=${badgeclass.get('criteria')}">
                    <img class="share_icon" src="/static/images/badges/social_googleplus.png" />
                  </a>
                  <a target="_blank" title="${_("Tweet")}" href="https://twitter.com/intent/tweet?text=I earned the %22${badgeclass.get('name')}%22 badge in ${course.number} on %23edX!&url=${badgeclass.get('criteria')}">
                    <img class="share_icon" src="/static/images/badges/social_twitter.png" />
                  </a>
                  <a target="_blank" title="${_("Share")}" href="https://www.facebook.com/dialog/feed?app_id=202824819884271&link=${badgeclass.get('criteria')}&picture=${badge.get('image')}&name=${badgeclass.get('name')}&description=${badgeclass.get('description')}&redirect_uri=http://www.edx.org/">
                    <img class="share_icon" src="/static/images/badges/social_facebook.png" />
                  </a>
                </p>
                <div style="padding-left:120px">
                  <h3>${badgeclass.get('name')}</h3>
                  <p>
                    <b>${badgeclass.get('description')}</b><br />
                    %if issuer.get('name', False):
                      ${_('awarded on {date} by {issuer}').format(
                        date='<b>'+badge.get('issuedOn')+'</b>',
                        issuer="<a href=\"" + issuer.get('origin', '') + "\">" + issuer.get('name') + "</a>")
                      }
                    %else:
                      ${_('awarded on {date}').format(date='<b>'+badge.get('issuedOn')+'</b>')}
                    %endif
                    <br />
                    <i>
                    %if num is not None:
                      ${_('{number} people have this badge.').format(number=num)}
                    %endif
                    </i>
                  </p>
                  <div class="mozilla_info" style="display: none;">
                    <hr/>
                    <p>
                      <input type='button' class='mozilla_export' value='${_('Export')}' />
                      ${_('Exporting these badges to <a href="http://beta.openbadges.org">Mozilla Backpack</a>? When signing in with Mozilla Persona, make sure to use your <b>{email}</b> email address.').format(email=student.email)}
                    </p>
                  </div>
                </div>
              </li>
            %endfor
          </ol>
        </li>
        %endif
        %if len(badgeclasses) >= len(badges):
        <li>
          <h2>${_('Unlockable')}</h2>
          <ol class="sections">
            <%first = True%>

            %for key in badgeclasses.keys():
              %if not key in badges.keys():
                <%badgeclass = badgeclasses.get(key)%>
                <%num = badgeclass.get('edx_number_awarded')%>

                %if first:
                  <%first = False%>
                %else:
                  <hr style="clear:both;"/>
                %endif

                <li>
                  <a href="${badgeclass.get('criteria')}">
                    <img src="${badgeclass.get('image')}" class="unlockable badge_image" />
                  </a>
                  <div style="padding-left:120px">
                    <p>
                    <b>${badgeclass.get('description')} </b><br />
                    <i>
                    %if num is not None:
                      ${_('{number} people have this badge.').format(number=num)}
                    %endif
                    </i>
                    </p>
                  </div>
                </li>
              %endif
            %endfor
          </ol>
        </li>
        %endif
      </ol>
      <a href="http://openbadges.org/" style="float:right"><img src="/static/images/badges/openbadges_insignia_weissue.png" /></a>
      %else:
       <p>${_('No badges found.')}</p>
      %endif

    </section>
  </div>
</section>
